
MMEffect リファレンス 

0.1.0.0 (2010/9/18) 初版
0.2.0.0 (2010/12/12) MME Ver0.20
　?OFFSCREENRENDERTARGETセマンティクス追加
　?CONTROLOBJECTセマンティクスで取得できる情螭巫芳
　?CONTROLOBJECTセマンティクスが参照するオブジェクトの描画序の制sを和
　?EDGECOLORセマンティクス追加
　?VIEWPORTPIXELSIZEセマンティクスの述ミスを修正
　?一部日本Z修正
0.2.2.0 (2010/12/16) MME Ver0.22
　?RENDERCOLORTARGETおよびOFFSCREENRENDERTARGETセマンティクスでの、Miplevelsの指定方法を涓
0.2.3.0 (2010/12/20) MME Ver0.23
　?CONTROLOBJECTセマンティクスのa足追
0.2.4.0 (2011/02/09) MME Ver0.24
　?CONTROLOBJECTセマンティクスに指定できる特殊オブジェクト名に"(self)"を追加
　?TEXTUREVALUEセマンティクスを追加
0.2.6.0 (2010/02/21) MME Ver0.26
　?Draw=Geometryコマンドについての述を修正
0.2.7.0 (2011/05/22) MME Ver0.27
　?_INDEXセマンティクス追加
　?VertexCountパラメ`タおよびSubsetCountパラメ`タを追加
　?opaddパラメ`タの追加
　?TEXTUREVALUEセマンティクスのa足に追
0.2.8.0 (2012/03/26) MME Ver0.28
　?CONTROLOBJECTセマンティクスについての述を一部修正
0.3.0.0 (2012/09/19) MME Ver0.30
　?OFFSCREENRENDERTARGETセマンティクスのDefaultEffectに指定可能な
　　特殊なエフェクト名として"main_default"を追加
0.3.3.0 (2013/02/13) MME Ver0.33
　?テクスチャの材|モ`フ用セマンティクス（ADDINGTEXTURE等）追加
　?PMXモデルのサブテクスチャに辏UseSphereMap, use_spheremap, use_subtexture参照）
　?MATERIALTOONTEXTUREセマンティクス追加
　?GROUNDSHADOWCOLORセマンティクス追加
　?MME_MIPMAPマクロ追加


○注意
?このリファレンスでは、MMEffectがJRするセマンティクス＆アノテ`ションについて解hしている。
　エフェクトファイルそのもののリファレンスについては、以下を参照のこと。
　
　　エフェクトファイルフォ`マット http://msdn.microsoft.com/ja-jp/library/bb173005(v=VS.85).aspx
　　HLSLのリファレンス            http://msdn.microsoft.com/ja-jp/library/bb509638(v=VS.85).aspx

?セマンティクス＆アノテ`ションの仕の策定は、NVIDIAのSASを参考にした。
　　http://developer.nvidia.com/object/using_sas.html
　ただしこれは、FX Composer用のエフェクトファイルが幼鳏工毪长趣虮Ｕ悉工毪猡韦扦悉胜ぁ

＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊

１　テクニックとパス

1.1　成

エフェクトファイルは、以下のような、テクニックとパスによるA造になっている。

/**********************************/
パラメ`タ宣言1
パラメ`タ宣言2
...

technique テクニック1 {
    pass パス1 {
        VertexShader = …
        PixelShader  = …
    }
    pass パス2 {
        VertexShader = …
        PixelShader  = …
    }
    …
}

technique テクニック2 {
    pass パス1 {
        VertexShader = …
        PixelShader  = …
    }
    pass パス2 {
        VertexShader = …
        PixelShader  = …
    }
    …
}
/**********************************/

テクニックは１つ以上のパスから成される。
１つのパスは1回のレンダリングI理に辘筏皮り、
テクニックが}数のパスから成されている龊悉稀
そのテクニックがマルチパスレンダリングを使用することを意味している。


テクニックとパスには、アノテ`ションと呼ばれるO定を述することができる。
アノテ`ションは、以下のように、テクニック名?パス名の後ろに、"<"と">"で欷啶瑜Δ摔筏朴述する。
なお、アノテ`ション名の大文字小文字の`いはoされる。

/******************************************************/
technique Tech1 < string Subset = "1-6,8"; > {
    pass Pass1 < string Script = "Draw=Buffer;"; > {
        ...
    }
    pass Pass2 {
        ...
    }
}
/******************************************************/

また、テクニックとパスには、スクリプトと呼ばれる特殊なアノテ`ションを
指定することができる。これについては、§３でh明する。


1.2　テクニックのアノテ`ション

テクニックのアノテ`ションには、
そのテクニックをどの雒妞蚊杌に使用するかの条件を述する。


この条件には、以下のものを指定できる。

?オブジェクトのサブセット番号（Pオブジェクトのマテリアルの番号）
?描画象（オブジェクト本体/影/郭/セルフシャドウ用Zプロット）
?描画フラグ（テクスチャ使用ON/OFF、スフィアマップ使用ON/OFF、トゥ`ンレンダリング使用ON/OFF）

条件の照合は、エフェクトファイルにかれているに行われるため、
}数のテクニックで使用条件が重なっている龊悉稀
エフェクトファイル上で先に述されているものが先される。
条件に合致するテクニックがエフェクトファイル上に存在しない龊稀
MMD胜违伐З`ダが使用される。


○アノテ`ション

?string Subset
　　そのテクニックをm用するサブセットの番号を指定する。
　　PMDモデルの龊稀これはモデルの材|番号に辘工搿
　　
　　アノテ`ション省略rには、全てのサブセットがm用象となる。
　　
　　"0,3,5"のように、カンマ区切りで番号を列い工毪长趣恰⒀}数の番号を指定できる。
　　また、"6-10"などのように、番号をハイフンでつなぐことで、熘付àできる。
　　"12-"のように、欷伍_始番号のみを指定した龊悉稀それ以降の全ての番号が象となる。

　　例： string Subset = "0-6,8";

?string MMDPass
　　そのテクニックをm用する描画象を指定する。
　　以下のうちいずれかを指定する。この区分は、MMDの描画手に由来する。

　　"object"    : オブジェクト本体（セルフシャドウOFF）
　　"zplot"     : セルフシャドウ用Zプロット
　　"object_ss" : オブジェクト本体（セルフシャドウON）
　　"shadow"    : 影（セルフシャドウではないgな影）
　　"edge"      : 郭（PMDモデルのみ）

　　アノテ`ション省略rには、"object"を指定したとみなされる。

　　例： string MMDPass = "object";

?bool UseTexture
　　テクスチャ使用の有oを指定する。
　　そのテクニックが、テクスチャを使用するサブセットのみを象とする龊悉摔稀trueを指定する。
　　逆に、テクスチャを使用しないサブセットのみを象とする龊悉摔稀falseを指定する。

　　アノテ`ション省略rには、テクスチャの有oはoされる。

　　例： bool UseTexture = true;

?bool UseSphereMap
　　スフィアマップ使用の有oを指定する。
　　そのテクニックが、スフィアマップを使用するサブセットのみを象とする龊悉摔稀trueを指定する。
　　（PMXモデルにおいて、スフィアモ`ドにサブテクスチャを指定した龊悉夂む）
　　逆に、スフィアマップを使用しないサブセットのみを象とする龊悉摔稀falseを指定する。

　　アノテ`ション省略rには、スフィアマップの有oはoされる。

　　例： bool UseSphereMap = false;

?bool UseToon
　　トゥ`ンレンダリング使用の有oを指定する。
　　そのテクニックが、トゥ`ンレンダリングを使用するオブジェクト（＝PMDモデル）を象とする龊悉摔稀trueを指定する。
　　逆に、トゥ`ンレンダリングを使用しないオブジェクト（＝アクセサリ）を象とする龊悉摔稀falseを指定する。

　　アノテ`ション省略rには、トゥ`ンレンダリング使用の有oはoされる。

　　例： bool UseToon = true;


○使用例
    
    //セルフシャドウがONの龊稀サブセットのNo.0～6とNo.8には、Tech1がm用され、
    //サブセットのNo.7とNo.9～には、Tech2がm用される。
    //セルフシャドウがOFFの龊稀Tech3がm用される。

    technique Tech1 <
        string MMDPass = "object_ss"; 
        string Subset = "0-6,8";
    > {
        ...
    }

    technique Tech2 <
        string MMDPass = "object_ss"; 
        string Subset = "7,9-";
    > {
        ...
    }

    technique Tech3 <
        string MMDPass = "object"; 
    > {
        ...
    }

○a足
　?妥当でないテクニックは除外される。
　　http://msdn.microsoft.com/ja-jp/library/bb206324(v=VS.85).aspx
　?MMDPass="object","object_ss"以外のテクニックでは、UseTexture,UseSphereMap,UseToonは正しくC能しない。


＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊

２　パラメ`タのセマンティクスとアノテ`ション

以降では、MMEffect用のエフェクトファイルで使用できる、
パラメ`タのセマンティクスとアノテ`ションについてh明する。

パラメ`タの宣言をセマンティクスやアノテ`ションで修することで、
レンダリングに必要な々な情螭颉そのパラメ`タを解して取得できる。


パラメ`タのセマンティクスとアノテ`ションは、以下のように述する。

   型名 パラメ`タ名 : セマンティクス名 < 型名 アノテ`ション1 = ; 型名 アノテ`ション2 = ; ... > ;

セマンティクスによっては、アノテ`ションを指定しないものもある。


なお、セマンティクス名とアノテ`ション名の大文字小文字の`いはoされる。


2.1 ジオメトリQ
参考：http://msdn.microsoft.com/ja-jp/library/bb206269(v=VS.85).aspx

●WORLD
●VIEW
●PROJECTION
●WORLDVIEW
●VIEWPROJECTION
●WORLDVIEWPROJECTION

　点の座Qに使用するQ行列。
　
　座Qには、ワ`ルドQ、ビュ`Q、プロジェクションQ（射影Q）がある。
　
  6つのセマンティクスは、それぞれ、
　　WORLD               : ワ`ルドQ行列
　　VIEW                : ビュ`Q行列
　　PROJECTION          : プロジェクションQ行列　
　　WORLDVIEW           : ワ`ルドQ行列×ビュ`Q行列
　　VIEWPROJECTION      : ビュ`Q行列×プロジェクションQ行列
　　WORLDVIEWPROJECTION : ワ`ルドQ行列×ビュ`Q行列×プロジェクションQ行列
　を表す。
　型はfloat4x4。
　
　"WORLDINVERSE"のように、セマンティクスの末尾に"INVERSE"を付加すると、各行列の逆行列が得られる。
　また、"WORLDTRANSPOSE"のように、末尾に"TRANSPOSE"を付加すると、各行列の置行列が得られる。
　逆行列の置行列を得るには、末尾に"INVERSETRANSPOSE"を付加する。


　○アノテ`ション
　?string Object (省略可能)
　　　ビュ`QおよびプロジェクションQにおいて、どこを点とするかを指定する。
　　　"Camera"または"Light"が指定できる。デフォルトは"Camera"である。

　　　通常の、カメラを点とした座Qを行う龊悉摔稀"Camera" を指定する。
　　　セルフシャドウのためのZプロット等、光源を点とした座Qを行う龊悉摔稀"Light"を指定する。

  ○使用例
    float4x4 WorldMatrix : WORLD ;
    float4x4 WorldViewProjMatrix : WORLDVIEWPROJECTION ;
    float4x4 LightViewMatrix : VIEW < string Object = "Light"; > ;
    float4x4 WorldInvMatrix : WORLDINVERSE ;
    float4x4 WorldViewProjTransMatrix : WORLDVIEWPROJECTIONTRANSPOSE ;

　○a足
　　?Objectアノテ`ションに"Light"を指定したときに得られる行列は、
　　　MMDのセルフシャドウI理に使用している行列とB婴筏皮い毪郡帷
　　　[表示(V)]-[セルフシャドウ表示(P)]で、セルフシャドウC能を完全にOFFにしてしまうと、
　　　正しいを参照できなくなる。


2.2 ライトとマテリアル
参考：http://msdn.microsoft.com/ja-jp/library/bb174694(v=VS.85).aspx

●DIFFUSE
●AMBIENT
●EMISSIVE
●SPECULAR
●SPECULARPOWER
●TOONCOLOR
●EDGECOLOR
●GROUNDSHADOWCOLOR

　3Dオブジェクトのマテリアル(材|)の色、またはライトの色。

　6つのセマンティクスは、それぞれ、
　　DIFFUSE       　　: ディフュ`ズ色（散光）
　　AMBIENT       　　: アンビエント色（h境光）
　　EMISSIVE      　　: エミッション色（放射光）
　　SPECULAR      　　: スペキュラ色（R面光）
　　SPECULARPOWER 　　: スペキュラの度
　　TOONCOLOR     　　: トゥ`ン色
　　EDGECOLOR     　　: 郭色
　　GROUNDSHADOWCOLOR : 地面影色
　を表す。
　
　トゥ`ン色は、PMDモデルのトゥ`ンレンダリングにおける、影の色（具体的にはtoon??.bmpの左下隅の色）を表す。
　
　型は、"SPECULARPOWER"のみfloatで、それ以外はfloat3またはfloat4ある。
　色は4つの成分（赤?v?青?アルファ(透明度)）で成される。型にfloat3を指定するとアルファが省略される。


　○アノテ`ション
　?string Object (必)
　　　ライト色と、オブジェクトのマテリアル色のどちらを取得するかを指定する。
　　　"Light"または"Geometry"が指定できる。

　　　オブジェクトのマテリアル色を取得するには、"Geometry"を指定する。
　　　ライト色を取得するには、"Light"を指定する。
　　　"SPECULARPOWER"と"EMISSIVE"および"TOONCOLOR"には、ライト色がないため、"Light"は指定できない。

  ○使用例
    float4 MaterialDiffuse  : DIFFUSE  < string Object = "Geometry"; >;
    float3 MaterialAmbient  : AMBIENT  < string Object = "Geometry"; >;
    float3 MaterialEmmisive : EMISSIVE < string Object = "Geometry"; >;
    float3 MaterialSpecular : SPECULAR < string Object = "Geometry"; >;
    float  SpecularPower    : SPECULARPOWER < string Object = "Geometry"; >;
    float3 MaterialToon     : TOONCOLOR;
    float3 EdgeColor        : EDGECOLOR;
    float3 LightDiffuse     : DIFFUSE   < string Object = "Light"; >;
    float3 LightAmbient     : AMBIENT   < string Object = "Light"; >;
    float3 LightSpecular    : SPECULAR  < string Object = "Light"; >;
    static float4 DiffuseColor  = MaterialDiffuse  * float4(LightDiffuse, 1.0f);
    static float3 AmbientColor  = MaterialAmbient  * LightAmbient + MaterialEmmisive;
    static float3 SpecularColor = MaterialSpecular * LightSpecular;
	float4 GroundShadowColor : GROUNDSHADOWCOLOR;

　○a足
　　?郭色はMMDPass="edge"のTechniqueにおいてしか、正しく取得できない。
　　?地面影色はMMDPass="shadow"のTechniqueにおいてしか、正しく取得できない。
　　?その他の各色は、MMDPass="zplot"またはMMDPass="edge"のTechniqueにおいては、正しく取得できない。


●POSITION
●DIRECTION
　
　ライトまたはカメラの、ワ`ルド空g内における位置および向き。
　型は、float3またはfloat4である。


　○アノテ`ション
　?string Object (必)
　　　カメラおよびライトのどちらの座摔蛉〉盲工毪を指定する。
　　　"Camera"または"Light"が指定できる。

  ○使用例
    float3 LightDirection : DIRECTION < string Object = "Light"; >;
    float3 CameraPosition : POSITION  < string Object = "Camera"; >;

　○a足
　　?MMDのライトは、ディレクショナルライトであるため、
　　　ライトの位置座摔稀ライトの向きと逆方向のo限h点になる。


●MATERIALTEXTURE
　
　マテリアルにO定されているテクスチャ。

　○アノテ`ション
　　なし

  ○使用例
    texture ObjectTexture : MATERIALTEXTURE;
    
    sampler ObjTexSampler = sampler_state
    {
        texture = <ObjectTexture>;
        MINFILTER = LINEAR;
        MAGFILTER = LINEAR;
        MIPFILTER = LINEAR;
        ADDRESSU  = WRAP;
        ADDRESSV  = WRAP;
    };
    // tex2D(ObjTexSampler, float2(x,y)) で内容を参照できる

　○a足
　　?各色は、MMDPass="zplot"またはMMDPass="edge"のTechniqueにおいては、正しく取得できない。

●MATERIALSPHEREMAP
　
　マテリアルにO定されている、スフィアマップテクスチャ。

　○アノテ`ション
　　なし

  ○使用例
    texture ObjectSphereMap : MATERIALSPHEREMAP;
    
    sampler ObjSphSampler = sampler_state
    {
        texture = <ObjectSphereMap>;
        MINFILTER = LINEAR;
        MAGFILTER = LINEAR;
        MIPFILTER = LINEAR;
        ADDRESSU  = WRAP;
        ADDRESSV  = WRAP;
    };
    // tex2D(ObjSphSampler, float2(x,y)) で内容を参照できる

　○a足
　　?各色は、MMDPass="zplot"またはMMDPass="edge"のTechniqueにおいては、正しく取得できない。

●MATERIALTOONTEXTURE
　
　マテリアルにO定されている、トゥ`ンマップテクスチャ。

　○アノテ`ション
　　なし

  ○使用例
    texture ObjectToonTexture : MATERIALTOONTEXTURE;
    
    sampler ObjToonSampler = sampler_state
    {
        texture = <ObjectSphereMap>;
        MINFILTER = LINEAR;
        MAGFILTER = LINEAR;
        MIPFILTER = NONE;
        ADDRESSU  = CLAMP;
        ADDRESSV  = CLAMP;
    };
    // tex2D(ObjToonSampler, float2(x,y)) で内容を参照できる

　○a足
　　?各色は、MMDPass="zplot"またはMMDPass="edge"のTechniqueにおいては、正しく取得できない。
　　?また、アクセサリの龊希UseToon=falseの龊希─稀⒄しく取得できない。
　　?PMDモデルにおいて、トゥ`ンを使用しないマテリアルの龊悉稀⑷面白色のテクスチャとなる。

●ADDINGTEXTURE
●MULTIPLYINGTEXTURE
●ADDINGSPHERETEXTURE
●MULTIPLYINGSPHERETEXTURE
　
　PMX材|モ`フのための、テクスチャおよびスフィアマップのテクスチャにしての、
　加算および\算。

　○アノテ`ション
　　なし

  ○使用例
    float4   TextureAddValue   : ADDINGTEXTURE;
    float4   TextureMulValue   : MULTIPLYINGTEXTURE;
    float4   SphereAddValue    : ADDINGSPHERETEXTURE;
    float4   SphereMulValue    : MULTIPLYINGSPHERETEXTURE;

　○a足
　　?各は、MMDPass="object_ss"の龊悉扦筏、正しく取得できない。
　　?また、アクセサリの龊希UseToon=falseの龊希─稀⒓铀は全て0、\算は全て1になる。


2.3 スクリ`ン情

●VIEWPORTPIXELSIZE

　レンダリングタ`ゲットのスクリ`ンのサイズ。
　型はfloat2。g位はピクセル。
　
　※このは、MMDのスクリ`ンもしくはオフスクリ`ンレンダリングタ`ゲットのサイズを指す。
　　Scriptsの"RenderColorTarget"コマンドで、レンダリングタ`ゲットが涓しても、
　　このは浠しない。
　
　○アノテ`ション
　　なし

  ○使用例
    float2 ScreenSize : VIEWPORTPIXELSIZE;

　○a足
　　?内部的には、Viewportの.Widthと.Heightのを参照している。


2.4 rg

●TIME
●ELAPSEDTIME

　rg情蟆
　型はfloat。g位は秒。
　
　"TIME"は、0フレ`ム目からの再生rgを表す。
　例えば、0フレ`ム目では、0.0（秒）となり、45フレ`ム目では1.5（秒）となる。
　
　"ELAPSEDTIME"は、前回の描画からのU^rgを表す。
　例えば、60fpsでAVI出力rには、"ELAPSEDTIME"のは、1/60 で一定になる。
　
　○アノテ`ション
　?bool SyncInEditMode  (省略可能)
　　　MMDが集モ`ドである龊悉扦狻フレ`ムとB婴工毪を指定する。
　　　trueまたはfalseを指定する。デフォルトはfalse。
　　　
　　　MMDが集モ`ドのときには、フレ`ムの再生は停止しているため、
　　　TIMEのが常にフレ`ムrgとB婴筏皮い毪取
　　　集モ`ド中は、このを使用しているアニメ`ションも停止することになる。
　　　
　　　このアノテ`ションにfalseが指定されていると、
　　　集モ`ド中、TIMEおよびELAPSEDTIMEのには、フレ`ムrgではなくシステムrgが使用される。
　　　これにより、集モ`ド中でもアニメ`ションが停止しなくなる。

  ○使用例
    float ftime : TIME <bool SyncInEditMode=true;>;
    float elapsed_time : ELAPSEDTIME;
    static float fps = 1.0 / elapsed_time;

　○a足
　　?SyncInEditMode=trueの龊稀ELAPSEDTIMEのは、MMD上でのフレ`ム移硬僮鳏摔瑜辍0やマイナスになりうる。


2.5 マウス

●MOUSEPOSITION

　マウスのF在位置。
　型はfloat2。

　MMDの描画I域の中心を(0,0)とし、左下隅が(-1,-1)、右上隅が(1,1)になる。
　このxy座摔稳・攴饯稀プロジェクションQした後の、点座摔韧じである。

　○アノテ`ション
　　なし

  ○使用例
    float2 pos : MOUSEPOSITION;


●LEFTMOUSEDOWN
●MIDDLEMOUSEDOWN
●RIGHTMOUSEDOWN

　マウスボタンにvする情蟆
　型はfloat4。
　
　取得できるは、以下の4成分からなる。
　?最後にボタンが押されたときのマウスの座耍xとy）
　?F在ボタンが押されているか （0 or 1）
　?最後にボタンが押されたr点のTIME(秒)
　
　なお、マウスの座摔稳・攴饯稀MOUSEPOSITIONと同じである。

　○アノテ`ション
　　なし

  ○使用例
    float4 mouse_down : LEFTMOUSEDOWN;
    static float2 pos = mouse_down.xy;
    static bool is_pressed = (mouse_down.z != 0);


2.6 コントロ`ルオブジェクト

●CONTROLOBJECT

　指定したオブジェクトの、座摔浈铹`ルドQ行列を取得する。
　主に、シェ`ダに必要なパラメ`タをMMD上から制御する龊悉耸褂盲工搿
　
　型はbool, float, float3, float4またはfloat4x4。
　
　使用する型によって、取得できる情螭なる。
　
　?bool
　　　指定したオブジェクトが表示されているか否か
　?float
　　　指定したオブジェクトのスケ`リング
　?float3, float4
　　　指定したオブジェクトの座耍ēフセット）
　?float4x4
　　　指定したオブジェクトのワ`ルドQ行列

　また、itemアノテ`ションに特殊な文字列を指定することにより、
　これら以外のも取得できる。

　○アノテ`ション
　?string name  (必)
　　　オブジェクトのファイル名を指定する（フォルダパスは含めない）。
　　　
　　　特殊なファイル名"(self)"を指定すると、
　　　そのエフェクトが割り当てられたオブジェクト自身を象にできる。
　　　
　　　また、特殊なファイル名"(OffscreenOwner)"を指定すると、
　　　オフスクリ`ンのオ`ナ`のオブジェクトを象にできる（オフスクリ`ンレンダリング中の龊悉韦撸。
　　　ここで、オフスクリ`ンのオ`ナ`とは、OFFSCREENRENDERTARGETが宣言されているエフェクトが
　　　割り当てられたオブジェクトを指す
　　　
　?string item  (省略可能)
　　　オブジェクトの特殊なを取得したい龊悉酥付à工搿
　　　
　　　以下のうちいずれかを指定する。
　　　　ボ`ン名 : PMDモデルの指定ボ`ンの座摔蓼郡膝铹`ルドQ行列を取得する。
　　　　　　　　 　型はfloat3,float4,float4x4のうちいずれか。
　　　　表情名　 : PMDモデルの指定した表情のを取得する。型はfloat。
　　　　
　　　　"X"      : アクセサリの位置X(アクセサリパネルのX)。型はfloat。
　　　　"Y"      : アクセサリの位置Y(アクセサリパネルのY)。型はfloat。
　　　　"Z"      : アクセサリの位置Z(アクセサリパネルのZ)。型はfloat。
　　　　"XYZ"    : アクセサリの位置(アクセサリパネルのX,Y,Z)。型はfloat3。
　　　　"Rx"     : アクセサリの回X(アクセサリパネルのRx)。型はfloat。(※１）
　　　　"Ry"     : アクセサリの回Y(アクセサリパネルのRy)。型はfloat。
　　　　"Rz"     : アクセサリの回Z(アクセサリパネルのRz)。型はfloat。
　　　　"Rxyz"   : アクセサリの回(アクセサリパネルのRx,Ry,Rz)。型はfloat3。
　　　　"Si"     : アクセサリのサイズ(アクセサリパネルのSi)。型はfloat。（※２）
　　　　"Tr"     : アクセサリの透明度(アクセサリパネルのSi)。型はfloat。
　　　　　
　　　　　※１　得られるは、パネル上のをラジアンで表したものである。
　　　　　※２　得られるは、パネル上のを10倍したものである。
　　　　　
  ○使用例
    //"stage01.x"が表示されているか否かを取得
    bool flag : CONTROLOBJECT < string name = "stage01.x"; >;
    
    //"negi.x"のスケ`リングを取得
    float scaling : CONTROLOBJECT < string name = "negi.x"; >;

    //"negi.x"の回Xを取得
    float rot_x : CONTROLOBJECT < string name = "negi.x"; string item = "Rx"; >;

    //"negi.x"の回Xを度数g位で取得
    float rot_x_rad : CONTROLOBJECT < string name = "negi.x"; string item = "Rx"; >;
    static float rot_x = rot_x_rad * 180 / 3.14159265;

    //"弱音ハク.pmd"のボ`ン「ポニテＩＫ」の座巳〉
    float3 pos : CONTROLOBJECT < string name = "弱音ハク.pmd"; string item = "ポニテＩＫ"; >;

    //"弱音ハク.pmd"の表情「まばたき」の取得
    float morph : CONTROLOBJECT < string name = "弱音ハク.pmd"; string item = "まばたき"; >;

　○a足
　　?PMDモデルのワ`ルドQ行列はg位行列で浠しないため、
　　　通常は、Xファイル（アクセサリ）にして使用する。
　　?アクセサリのスケ`リングは、MMD上でアクセサリのSizeに指定したを10倍したになる。
　　　（内部的には、length(world_matrix._11_12_13) で得られるを使用している）
　　?指定したファイル名のオブジェクトが存在しない龊稀⒁韵陇がO定される。
　　　　Xファイルの龊希
　　　　　スケ`リング　：10
　　　　　オフセット　　：(0,0,0,1)
　　　　　ワ`ルドQ行列：スケ`リング行列（xyz各10倍）
　　　　　特殊item　　　：0
　　　　PMDファイルの龊希
　　　　　スケ`リング　：1
　　　　　オフセット　　：(0,0,0,1)
　　　　　ワ`ルドQ行列：g位行列
　　　　　ボ`ンの座恕　。(0,0,0,1)
　　　　　ボ`ンのQ行列：g位行列
　　　　　表情　　　　　：0

　　?MME ver0.20より、参照先のオブジェクトが参照元のオブジェクトよりも後に描画されていても、
　　　を取得できるようになった。
　　　
　　?指定した名前を持つオブジェクトが}数存在する龊稀⒁韵陇先位でxkされる。
　　　　(1) 参照元のオブジェクトよりも描画序が先で、かつ最も描画序が近いもの。
　　　　(2) 描画序が最後のもの

　　?ダミ`ボ`ン.pmdなどのように、点を一つも持たないオブジェクトについては、
　　　参照先に指定しても座摔蛉〉盲扦ない。


2.7 テクスチャvB

●通常テクスチャ

　テクスチャを生成する。

　型はtexture, texture2D, texture3D, textureCUBEのうちいずれか。
　RENDERCOLORTARGET, RENDERDEPTHSTENCILTARGET, ANIMATEDTEXTURE 以外のセマンティクスは指定してもoされる。
　
　生成したテクスチャの内容は、サンプラをO定した上で、tex2D(s, t)v数などを呼び出すことで参照できる。


　○アノテ`ション
　?string ResourceType
　　　テクスチャのNを指定する。"2D", "3D", "CUBE"のうちいずれかを指定する。
　　　型と矛盾したは指定できない。

　　　型が"texture"であり、かつ"2D"以外のテクスチャを生成する龊悉摔稀
　　　かならずこのアノテ`ションを指定しなければならない。それ以外では省略可能である。

　?string ResourceName
　　　テクスチャの元になる画像ファイルを指定する。
　　　サポ`トしているファイルフォ`マットは、bmp、.dds、.dib、.jpg、.png、および .tga である。
　　　相パスでファイル名を指定した龊稀エフェクトファイルが格{されているフォルダが基胜趣胜搿

　?int Width
　?int Height
　?int Depth
　　　テクスチャの幅、高さ、深さをピクセルg位で指定する。
　　　深さを指定するのはボリュ`ムテクスチャの龊悉韦撙扦る。
　　　
　　　Dimensions, ViewportRatio とは同rに指定できない。
　　　
　　　(Width,Height,Depth), Dimensions, ViewportRatioのいずれも指定されていない龊悉巍
　　　デフォルトは、64ピクセルである。
　　　また、ResourceNameが指定されているならば、画像ファイルからサイズが自拥膜巳〉盲丹欷搿
　　　
　?int2(or int3) Dimensions
　　　テクスチャの幅、高さ、深さをピクセルg位で指定する。
　　　深さを指定するのはボリュ`ムテクスチャの龊悉韦撙扦る。
　　　
　　　ViewportRatio, Width, Height, Depthとは同rに指定できない。
　　　
　?float2 ViewportRatio
　　　テクスチャの幅、高さを、レンダリングタ`ゲットのスクリ`ンのサイズとの比で指定する。
　　　スクリ`ンと同じサイズのテクスチャを生成するには、"float2 ViewportRatio = {1.0, 1.0};" と指定する。
　　　スクリ`ンのk横2倍のサイズのテクスチャを生成するには、"float2 ViewportRatio = {2.0, 2.0};" と指定する。
      
　　　Dimensions, Width, Height, Depthとは同rに指定できない。
　　　
　?string Format
　　　テクスチャのフォ`マットを指定する。
　　　
　　　省略した龊稀"A8R8G8B8"が使用される。
　　　ResourceNameが指定されているならば、画像ファイルからフォ`マットが取得され、
　　　このアノテ`ションのO定はoされる。
　　　
　　　指定可能なフォ`マットは、D3DFORMAT（http://msdn.microsoft.com/ja-jp/library/bb172558(v=VS.85).aspx）
　　　を参照。
　　　
　　　"A8R8G8B8"、"FMT_A8R8G8B8"、"D3DFMT_A8R8G8B8"のいずれの式でも指定できる。

　?int Miplevels
　　　ミップマップを指定したレベルで生成する。
　　　省略するか0を指定した龊稀⑼耆なミップマップ チェ`ンが作成される。
　　　1を指定すると、ミップマップは生成されない。
      
　?int Levels
　　　Miplevelsのe名である。

  ○使用例
    
    texture negi_tex < string ResourceName = "negi.bmp"; >;
    sampler TexSampler = sampler_state {
        texture = <negi_tex>;
    };
    
    texture2D map_tex <
        string ResourceName = "map.png";
        int Miplevels = 1;
        int Width = 64;
        int Height = 64;
    >;


●RENDERCOLORTARGET

　レンダリングタ`ゲットに指定可能なサ`フェイスを生成する。
　このセマンティクスを指定して生成したテクスチャは、スクリプトのRenderColorTargetに
　指定することができる。
　レンダリング後は、通常のテクスチャと同に、tex2D()v数で内容を参照できる。

　型はtexture, texture2Dのうちいずれか。
　
　○アノテ`ション

　?int Width, int　Height, int Depth
　?int2 Dimensions
　?float2 ViewportRatio
　　　"●通常テクスチャ"を参照。
　　　省略した龊稀"float2 ViewportRatio = {1.0, 1.0};" というO定が使用される。

　?string Format
　　　"●通常テクスチャ"を参照。
　　　省略した龊稀"A8R8G8B8"が使用される。

　?int Miplevels
　?int Levels
　　　"●通常テクスチャ"を参照。
　　　1または0が指定できる。
　　　0を指定した龊稀⑼耆なミップマップ チェ`ンが作成される。
　　　1を指定すると、ミップマップは生成されない（デフォルト）。

  ○使用例
    
    texture2D ScnMap : RENDERCOLORTARGET <
        float2 ViewPortRatio = {1.0,1.0};
        int MipLevels = 1;
        string Format = "A8R8G8B8" ;
    >;
    sampler2D ScnSamp = sampler_state {
        texture = <ScnMap>;
    };

    technique Tech <
        string Script = "RenderColorTarget0=ScnMap;
        ...


●RENDERDEPTHSTENCILTARGET

　深度ステンシルサ`フェイス（いわゆるZバッファ）を生成する。
　このセマンティクスを指定して生成したテクスチャは、スクリプトのRenderDepthStencilTargetに
　指定することができる。

　RENDERCOLORTARGETで生成したテクスチャとは`い、このセマンティクスで生成したテクスチャは、
　レンダリング後も、内容を参照することはできない。

　型はtexture, texture2Dのうちいずれか。

　○アノテ`ション

　?int Width, int　Height, int Depth
　?int2(or int3) Dimensions
　?float2 ViewportRatio
　　　"●通常テクスチャ"を参照。
　　　省略した龊稀"float2 ViewportRatio = {1.0, 1.0};" というO定が使用される。

　?string Format
　　　"●通常テクスチャ"を参照。
　　　省略した龊稀"D24S8"が使用される。

  ○使用例
    
    texture2D DepthBuffer : RENDERDEPTHSTENCILTARGET <
        float2 ViewPortRatio = {2.0,2.0};
        string Format = "D24S8";
    >;

    technique Tech <
        string Script = "RenderDepthStencilTarget=DepthBuffer;
        ...


●ANIMATEDTEXTURE
　
　アニメ`ションテクスチャを生成する。
　
　型はtexture, texture2Dのうちいずれか。
　
　デフォルトでは、フレ`ムrgにB婴筏谱拥膜衰ニメ`ションするほか、
　コントロ`ルオブジェクトなどの、eのパラメ`タにB婴筏匹ニメ`ションさせることもできる。

　○アノテ`ション

　?string ResourceName (必)
　　　テクスチャの元になる、アニメ`ション画像ファイルを指定する。
　　　サポ`トしているファイルフォ`マットは、.gif（アニメGIF) および .png（APNG）である。

　?float Offset (省略可能)
　　　アニメ`ションの_始rgをずらす。（g位：秒）
　　　例えば、2.5を指定すると、アニメ`ション_始を2.5秒Wらせることができる。
　　　デフォルトは0.0。

　?float Speed (省略可能)
　　　アニメ`ションの再生スピ`ドを指定する。
　　　例えば、2.0を指定すると、アニメ`ションの速度が2倍になる。
　　　デフォルトは1.0。

　?string SeekVariable (省略可能)
　　　アニメ`ションのシ`ク制御を、フレ`ムrg以外の方法で行う龊悉酥付à工搿
　　　パラメ`タ名を指定すると、そのパラメ`タのの浠にB婴筏啤アニメ`ションが行われる。

　　　デフォルトでは、フレ`ムrg(TIME<SyncInEditMode=true>)にB婴筏匹ニメ`ションする。

  ○使用例
    
    // オブジェクトseek.xのSizeの浠にB婴筏匹ニメ`ションする
    
    float atime: ControlObject < string Name = "seek.x"; >;
    
    texture AnimeTex : ANIMATEDTEXTURE <
        string ResourceName = "anime.png";
        string SeekVariable="atime";
    >;

　○a足
　　?アニメ`ションが要求するfpsを、MMDの描画のfpsが下回った龊稀コマ落ちがk生する。
　　?APNGについては、GByteg位の巨大なアニメ`ションファイルも（一辏┰偕可能。


●OFFSCREENRENDERTARGET
　
　オフスクリ`ンレンダリングタ`ゲット生成する。
　
　型はtexture, texture2Dのうちいずれか。
　
　オフスクリ`ンレンダリングタ`ゲットを生成すると、
　自拥膜恕⒅付à筏刻跫で全オブジェクトの描画が、このレンダリングタ`ゲットにして行われるようになる。
　
　レンダリングY果は、通常のテクスチャと同にtex2D()v数で参照できる。

　○アノテ`ション

　?int Width, int　Height, int Depth
　?int2 Dimensions
　?float2 ViewportRatio
　　　"●通常テクスチャ"を参照。
　　　省略した龊稀"float2 ViewportRatio = {1.0, 1.0};" というO定が使用される。

　?string Format
　　　"●通常テクスチャ"を参照。
　　　省略した龊稀"A8R8G8B8"が使用される。

　?int Miplevels
　?int Levels
　　　"●通常テクスチャ"を参照。
　　　1または0が指定できる。
　　　0を指定した龊稀⑼耆なミップマップ チェ`ンが作成される。
　　　1を指定すると、ミップマップは生成されない（デフォルト）。

　?float4 ClearColor
　　　レンダリングタ`ゲットをクリアする色をO定する。
　　　ここで指定した色で、レンダリングタ`ゲットは自拥膜衰リアされる。
　
　?float ClearDepth
　　　深度ステンシルサ`フェイスをクリアするZをO定する。
　　　ここで指定したZで、深度ステンシルサ`フェイスは自拥膜衰リアされる。
　
　?bool AntiAlias
　　　レンダリングにアンチエイリアスを使用する。デフォルトはfalse。
　　　※アンチエイリアスが有郡龊稀ビデオメモリは多く消Mされるため、
　　　　テクスチャのサイズには注意すること
　
　?string Description
　　　オフスクリ`ンレンダリングタ`ゲットのh明文を指定する。
　　　ここで指定した文字列が、エフェクト割当のGUIダイアログ上で表示される。
　
　?string DefaultEffect
　　　オフスクリ`ンレンダリングで使用するエフェクトファイルの割り当て方法を指定する。
　　　１つの割り当ては、以下の式で述する。
　　　
　　　　　"(オブジェクトファイル名)=(エフェクトファイル名);"
　　　
　　　オブジェクト挨耸褂盲工毳ē榨Дトファイルを切り替えるには、この割り当てを}数回述する。
　　　}数回述した龊稀⒂述したでオブジェクトファイル名が比^され、最初にマッチしたものが使用される。
　　　
　　　　例： string DefaultEffect = "self=hide; Mirror*.x=hide; *=MirrorObject.fx;";
　　　
　　　オブジェクトファイル名には"*"と"?"によるワイルドカ`ドが指定できる。
　　　特殊なオブジェクトファイル名として"self"が指定でき、これは、
　　　このOFFSCREENRENDERTARGETを持つエフェクトが割り当てられたオブジェクト自身を表す。
　　　
　　　エフェクトファイル名に相パスでファイル名を指定した龊稀
　　　参照元のエフェクトファイルが格{されているフォルダが基胜趣胜搿
　　　
　　　また、特殊なエフェクトファイル名として"none"と"hide"が指定でき、
　　　これは、「エフェクトなし」と「非表示」を表す。
　　　また、"main_default"を指定すると、メインスクリ`ンでのデフォルト幼鳏韧な、
　　　オブジェクトファイルパスに基づくfxファイルやemdファイルの自痈畹堡行われる。
　　　
  ○使用例
    
    texture MirrorRT: OFFSCREENRENDERTARGET <
        string Description = "OffScreen RenderTarget for Mirror.fx";
        int Width = 256;
        int Height = 256;
        float4 ClearColor = { 1, 1, 1, 1 };
        float ClearDepth = 1.0;
        bool AntiAlias = true;
        string DefaultEffect = 
            "self = hide;"
            "Mirror*.x = hide;"
            "*=MirrorObject.fx;";
    >;

●TEXTUREVALUE

　指定したテクスチャの、テクセル情螭蛉〉盲筏婆淞肖烁窦{する。
　これを使用すると、VTF(Vertex Texture Fetching)に辘筏胜きh境でも、
　点シェ`ダからテクスチャのを参照できる（※制限あり。a足参照）
　
　型はfloat4の2次元配列（[k幅][横幅]）、もしくは1次元配列。
　
　○アノテ`ション
　?string TextureName  (必)
　　　テクスチャのパラメ`タ名を指定する。
　　　
  ○使用例
    float4 ParticleBaseArray[TEX_HEIGHT][TEX_WIDTH] : TEXTUREVALUE <
        string TextureName = "ParticleBaseTex";
    >;
    float4 ParticleBaseArray2[TEX_HEIGHT] : TEXTUREVALUE <
        string TextureName = "ParticleBaseTex2";
    >;

    float4 color1 = ParticleBaseArray[v][u];
    float3 color2 = ParticleBaseArray2[idx].rgb;
   
　○a足
　　?定数レジスタでを渡すため、参照できるテクセル数は200程度が限度。
　　?配列のサイズがテクスチャのサイズと一致していない龊稀⒄しくが取得できる保^はoい。
　　　一部のh境では、2の累\のサイズのテクスチャしか作成できず、
　　　それ以外のサイズを指定しても、自拥膜衰单ぅ氦されて作成されることがあるので注意。
　　?テクスチャからのの取得は、フレ`ムの_始rに行われます。
　　　そのため、途中で象のテクスチャを更新しても、次のフレ`ムになるまでは更新されません。

2.8 エフェクトファイル

●STANDARDSGLOBAL
　
　SAS（Standard Annotations and Semantics）のバ`ジョンを指定する。
　また、エフェクトファイル全体にvするアノテ`ションを述するためにも用いられる。
　
　パラメ`タ名は "Script"、型は float、としてバ`ジョン番号の 0.8 を指定すること。
　
　
　○アノテ`ション

　?string ScriptOutput (省略可能)
　　　"color"以外のは指定できない。デフォルトもこのである。
　　　
　?string ScriptClass (省略可能)
　　　そのエフェクトファイルの目的（何を描画するエフェクトか）を指定する。
　　　
　　　以下のうちいずれかを指定する。
　　　
　　　　"object"        : オブジェクトを描画する。（デフォルト）
　　　　"scene"         : スクリ`ンバッファを描画する。
　　　　"sceneorobject" : 上のI方。
　　　
　　　基本的には、通常のオブジェクト描画用のエフェクトでは、"object"を指定し、
　　　プリエフェクト、ポストエフェクトでは、"scene"を指定する。
　　　
　　　"object"を指定した龊稀パスのスクリプトで Draw=Buffer をg行してはならない。
　　　また、"scene"を指定した龊稀 Draw=Geometry をg行してはならない。
　　　"sceneorobject"を指定した龊悉稀I方をg行できる。
　　　
　?string ScriptOrder (省略可能)
　　　そのエフェクトファイルのg行タイミングを指定する。
　　　
　　　以下のうちいずれかを指定する。
　　　
　　　　"standard"    : オブジェクトを描画する。（デフォルト）
　　　　"preprocess"  : オブジェクトの描画よりも先に描画する。プリエフェクト用。
　　　　"postprocess" : オブジェクトの描画の後で描画する。ポストエフェクト用。
　　　
　　　※正_には、preprocessのさらに前に、postprocessの前I理（テクニックのスクリプトの先^から
　　　　"ScriptExternal=Colorまで）がg行される。
　　　
　?string Script (省略可能)
　　　使用するテクニックの仕黜序を指定する。
　　　通常は、エフェクトファイルに述されているで、使用可能なテクニックが仕鳏丹欷(1.2)が、
　　　このアノテ`ションを用いると、その仕黜序を明示的に指定できる。
　　　
　　　以下の式で指定する。
　　　   "Technique=Technique?テクニック名1:テクニック名2:～;"
　　　
　　　　例：string Script = "Technique=Technique?SimplePS:TexturedPS:SimpleQuadraticPS:TexturedQuadraticPS;";
　　　
　　　なお、使用するテクニックが１つの龊悉摔稀⒁韵陇韦瑜Δ摔庵付à扦る。
　　　  string Script = "Technique=MainTech;";


  ○使用例
    
　　//通常エフェクトの龊
    float Script : STANDARDSGLOBAL <
        string ScriptOutput = "color";
        string ScriptClass = "object";
        string ScriptOrder = "standard";
    > = 0.8;

　　//ポストエフェクトの龊
    float Script : STANDARDSGLOBAL <
        string ScriptOutput = "color";
        string ScriptClass = "scene";
        string ScriptOrder = "postprocess";
    > = 0.8;


2.9 特殊パラメ`タ

以下の名前のパラメ`タは、セマンティクスoしで自拥膜がO定される。

●parthf (bool型)
　セルフシャドウフラグ。
　セルフシャドウのmode1/mode2に辏falseでmode1）。

●spadd (bool型)
　スフィアマップ加算合成フラグ（trueで加算合成）。

●transp (bool型)
　半透明フラグ（trueで半透明化）。
　[表示(V)]-[半透明化]に辍

●use_texture (bool型)
　テクスチャ使用フラグ。
　描画中のマテリアルがテクスチャを使用する龊悉true。

●use_spheremap (bool型)
　スフィアマップ使用フラグ。
　描画中のマテリアルがスフィアマップを使用する龊悉true。
　なお、PMXモデルのサブテクスチャを使用する龊悉trueとなる。

●use_subtexture (bool型)
　サブテクスチャ使用フラグ。
　PMXモデルのサブテクスチャを使用する龊悉true。

●use_toon (bool型)
　トゥ`ンレンダリング使用フラグ。
　PMDモデルの龊悉true。

●opadd (bool型)
　加算合成フラグ。
　オブジェクトの描画が加算合成モ`ドにO定されている龊悉true。

●VertexCount (int型)
　オブジェクトの点数。

●SubsetCount (int型)
　オブジェクトのサブセット数。

○使用例
  bool parthf;
  bool use_texture;
  bool use_toon;
  int VertexCount;

○a足
　?MMDPass="object","object_ss"以外の龊稀これらのパラメ`タに正しいがO定される保^はない。


2.9 点シェ`ダセマンティクス

●_INDEX
　
　点シェ`ダにおいて、点のインデックスを取得するためのセマンティクス。
　点シェ`ダの入力パラメ`タで使用できる。型はint。
　
  ○使用例
    
    VS_OUTPUT Basic_VS(float4 Pos : POSITION, int index: _INDEX) {
        VS_OUTPUT Out;
        Out.Pos = mul( Pos, WorldViewProjMatrix );

        float f = (float)index/VertexCount;
        Out.Color = float4(f,f,f,1);
        
        return Out;
    }

　○a足
　　?点シェ`ダに渡す^程で一旦float型にQしているため、
　　　インデックスが 2^24=16777216 を超えると、正_なを取得できない。


2.10 マクロ

●MME_MIPMAP

　MMDが、テクスチャのミップマップに辘筏皮い龊悉硕xされる。

　○使用例

    sampler ObjTexSampler = sampler_state {
　      texture = <ObjectTexture>;
    #ifdef MME_MIPMAP
        MIPFILTER = LINEAR;
    #endif
    };

　○a足

    
＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊

３　スクリプト

テクニックとパスには、スクリプトと呼ばれる特殊なアノテ`ションを指定することができる。

  technique テクニック名 < string Script = "コマンド; コマンド; ..." ; > { ... }
  pass パス名 < string Script = "コマンド; コマンド; ..." ; > { ... }

g行rには、これらのコマンドが、述に逐次g行される。

このスクリプトを使用することで、レンダリングタ`ゲットの涓やクリア、
パスのル`プI理などを行うことができる。

ポストエフェクトなどの特殊なI理をしないのであれば、通常、スクリプトの指定は不要である。
テクニックのスクリプトを省略した龊稀gにテクニックのパスがにg行される。
また、パスのスクリプトを省略した龊稀"Draw=Geometry"がg行される。


○コマンド

?RenderColorTarget=(テクスチャ名 or 空白)
?RenderColorTarget0=(テクスチャ名 or 空白)
?RenderColorTarget1=(テクスチャ名 or 空白)
?RenderColorTarget2=(テクスチャ名 or 空白)
?RenderColorTarget3=(テクスチャ名 or 空白)
　　
　　レンダリングタ`ゲットをO定する。
　　RenderColorTargetは、RenderColorTarget0のe名である。
　　
　　通常、RenderDepthStencilTargetコマンドとセットで使用する。
　　また、RenderColorTarget1～3はg独で使用することはできず、必ずRenderColorTarget0とセットで使用する。
　　
　　引数には、RENDERCOLORTARGETセマンティクスで宣言されたtextureパラメ`タの名前を指定する。
　　デフォルトのレンダリングタ`ゲットにリセットする龊悉稀⒖瞻驻蛑付à工搿
　　
　　なお、O定されたレンダリングタ`ゲットは、再度これらのコマンドをg行しなければ、
　　テクニックのI理完了まで涓されたままである。

?RenderDepthStencilTarget=(テクスチャ名 or 空白)
　　
　　深度ステンシルサ`フェイス（いわゆるZバッファ）をO定する。
　　通常、RenderColorTarget0コマンドとセットで使用する。
　　
　　引数には、RENDERDEPTHSTENCILTARGETセマンティクスで宣言されたtextureパラメ`タの名前を指定する。
　　デフォルトの深度ステンシルサ`フェイスにリセットする龊悉稀⒖瞻驻蛑付à工搿

?ClearSetColor=(パラメ`タ名)
　　
　　レンダリングタ`ゲットをクリアする色をO定する。（まだクリアはしない）
　　
　　引数には、float4型のパラメ`タの名前を指定する。
　　このパラメ`タにO定されたが、レンダリングタ`ゲットをクリアする色となる。

?ClearSetDepth=(パラメ`タ名)
　　
　　深度ステンシルサ`フェイスをクリアするZをO定する。（まだクリアはしない）
　　
　　引数には、float型のパラメ`タの名前を指定する。
　　このパラメ`タにO定されたが、深度ステンシルサ`フェイスをクリアするZとなる。

?Clear=Color
　　
　　レンダリングタ`ゲットをクリアする。
　　クリアする色には、ClearSetColorコマンドでO定されたが使用される。

?Clear=Depth
　　
　　深度ステンシルサ`フェイスをクリアする。
　　クリアするZには、ClearSetDepthコマンドでO定されたが使用される。

?ScriptExternal=Color
　　
　　他のオブジェクトを描画する。
　　このコマンドは、テクニックのスクリプト上でしか使用できない。
　　
　　これは、ポストエフェクト（STANDARDSGLOBALパラメ`タのScriptOrderアノテ`ションに
　　"postprocess"が指定されたエフェクトファイル）でのみg行できる。
　　
　　通常、ポストエフェクトでは、入力用のテクスチャをレンダリングタ`ゲットにO定した上で、
　　そのテクスチャへ、他のオブジェクトをレンダリングさせる。
　　この、他のオブジェクトをレンダリングさせるHに、このコマンドをg行する。
　　（Tipsのポストエフェクトを参照）
　　
　　ポストエフェクトでは、テクニックのスクリプト上で、必ず1回だけg行しなければならない。

?Pass=(パス名)
　　
　　指定したパスをg行する。
　　このコマンドは、テクニックのスクリプト上でしか使用できない。
　　
　　テクニックにスクリプトを指定した龊稀⒚魇镜膜摔长违偿蕙螗嗓蚴褂盲筏胜は蓼辍
　　いずれのパスもg行されない。

?LoopByCount=(パラメ`タ名)
?LoopEnd=
　　
　　指定した回数だけ、スクリプトの一部をル`プする。
　　このコマンドは、テクニックのスクリプト上でしか使用できない。
　　
　　引数には、数型（int,bool,float）のパラメ`タの名前を指定する。
　　このパラメ`タにO定されたの回数だけ、LoopByCountからLoopEndまでにあるコマンド列が
　　Rり返しg行される。
　　ル`プはネスト可能である。
　　
　　以下の例では、3回パスp0がg行された後、パスp1がg行される。
    
    /****************************/
    int Count = 3;
    
    technique TShader <
        string Script =
            "LoopByCount=Count;"
            "Pass=p0;"
            "LoopEnd=;"
            "Pass=p1;"; 
    > {
    /****************************/

?LoopGetIndex=(パラメ`タ名)
　　
　　ル`プ中のル`プカウンタのを、指定したパラメ`タにO定する。
　　このコマンドは、LoopByCountからLoopEndまでのgでしか使用できない。

?Draw=Geometry
　　
　　オブジェクトを描画する。
　　このコマンドは、パスのスクリプト上でしか使用できない。
　　
　　パスのスクリプトを省略した龊稀このコマンドがg行される。
　　STANDARDSGLOBALのScriptClassに"scene"を指定している龊稀
　　このコマンドをg行してはならない。

?Draw=Buffer
　　
　　レンダリングタ`ゲットのスクリ`ンと一致するサイズの、L方形のポリゴンを描画する。
　　このコマンドは、パスのスクリプト上でしか使用できない。
　　
　　ポストエフェクトやプリエフェクトで使用する。
　　STANDARDSGLOBALのScriptClassに"object"を指定している龊稀
　　このコマンドをg行してはならない。

?RenderPort=*
　　
　　未辍


○使用例
    technique TShader <
        /* 2つの文字列表("～" "～")のgに空白文字しかなければ、
           それはひとAきの文字列とみなされるため、以下のように分割して述できる */
        string Script = 
            "RenderColorTarget0=RenderTarget;"
    	    "RenderDepthStencilTarget=DepthBuffer;"
    		"ClearSetColor=ClearColor;"
    		"ClearSetDepth=ClearDepth;"
    		"Clear=Color;"
    		"Clear=Depth;"
    	    "ScriptExternal=color;"
    	    "Pass=P0;" ;
    > {
        pass P0 < string Script= "RenderColorTarget0=; RenderDepthStencilTarget=; Draw=Buffer;" ; > {
            ...
        }
    }


＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊＊

４　Tips

●MMD胜违伐З`ダを使用する

　オブジェクトの描画の一部にのみ、エフェクトを使用し、
　それ以外の描画にはMMD胜违伐З`ダを使用したい龊悉摔稀
　MMD胜违伐З`ダを使用したい雒妞违匹ニックを、エフェクトファイルに述しなければよい。
　（"1.2 テクニックのアノテ`ション"を参照）
　
　　/************************************************************/
    /* エフェクトファイルにこのテクニックしかoければ、
       オブジェクト描画（セルフシャドウONr）以外はMMD胜违伐З`ダで描画される */
      technique Tech1 < string MMDPass = "object_ss"; > {
          pass Pass1 {
              ...
          }
          pass Pass2 {
              ...
          }
      }
    /************************************************************/
　
　また、パスのデフォルトのシェ`ダはMMD胜违伐З`ダであるため、
　以下のように、パスのVertexShaderやPixelShaderをO定しなければ、
　そのパスの描画にはMMD胜违伐З`ダが使用される。
　
　　/************************************************************/
      technique Tech1 < string MMDPass = "object_ss"; > {
          pass Pass1 {
            // VertexShader = xxx
            // PixelShader  = xxx
          }
      }
    /************************************************************/
　

●空のテクニック

　以下のように、テクニックを空にすると、そのテクニックでは一切描画が行われなくなる。
　これを利用すると、オブジェクトの一部または全部の描画を抑止することができる。

　　/*********************************************************/
      technique ShadowTech < string MMDPass = "shadow";  > {
         
      }
　　/*********************************************************/


●オブジェクトの有oでパスをON/OFF

　以下のようにスクリプトを述すると、特定のオブジェクトの表示がONになっているgのみ
　パスをg行させることができる。
　これは、真true/falseが数としては1と0に解されることを利用している。

　　/*********************************************************/
      bool flag : CONTROLOBJECT < string name = "aaa.x"; >;
      
      technique Tech1 <
          string Script =
              "LoopByCount=flag;"
              "Pass=Pass1;"
              "LoopEnd=;"
               ; 
      > {
          pass Pass1 {
              ...
          }
      }
　　/*********************************************************/


●エフェクトファイルgでパラメ`タを共有
　
　通常、なるエフェクトファイルgでパラメ`タは共有されない。
　しかし、パラメ`タの宣言に"shared"キ`ワ`ドを指定することにより、
　同じ名前のパラメ`タをエフェクトファイルgで共有することができる。
　
　以下の例では、effect1.fxで生成したテクスチャを、effect2.fxから参照できる。
　このように、I方のパラメ`タ宣言で"shared"キ`ワ`ドを指定する必要がある。
　また、名前だけでなく、型名とセマンティクスも一致させるひつようがある。
　
　　/************** effect1.fx ******************/
      
　　  shared texture ShadowBuffer : RENDERCOLORTARGET <
          float2 ViewPortRatio = {2.0,2.0};
          int MipLevels = 1;
          string Format = "A8R8G8B8" ;
      >;
      
　　/********************************************/

　　/************** effect2.fx ******************/
      
　　  shared texture ShadowBuffer : RENDERCOLORTARGET;
      
　　/********************************************/


●if文
　
　描画を高速にしたければ、シェ`ダを述するHに、できるだけif文のような条件分岐は
　使わないほうがよい。
　
　テクスチャの有oでシェ`ダのI理を切り替えるような龊稀
　use_textureパラメ`タを参照して、シェ`ダ内のif文で条件分岐するより、
　テクスチャが有るサブセットとoいサブセットとで、テクニック自体を分けてしまうほうが高速に描画できる。


●uniformキ`ワ`ド
　
  v数の引数の宣言に"uniform"キ`ワ`ドを指定すると、その引数のをコンパイルrの定数として与えることができる。
　
　以下の例では、Basic_PS()内のif文が、コンパイルrに除去されるので、
　条件分岐による速度低下は避けられる（多分）。
　
　　/*******************************************************************/
　　float4 Basic_PS( VS_OUTPUT IN, uniform bool useTexture ) : COLOR0
    {
        float4 Color = IN.Diffuse;
        if ( useTexture ) {
            Color *= tex2D( ObjTexSampler, IN.Tex );
        }
        ...
    }
    
    technique TechWithTex {
        pass P1 {
            /* useTexture=true でシェ`ダをコンパイル */
            PixelShader  = compile ps_2_0 Basic_PS(true);  
            ...
        }
    }
    
    technique TechWithoutTex {
        pass P1 {
            /* useTexture=false でシェ`ダをコンパイル */
            PixelShader  = compile ps_2_0 Basic_PS(false);
            ...
        }
    }
　　/*******************************************************************/


●エフェクトファイル内での日本Z使用
　
　基本的に、コメント部分以外では、エフェクトファイル中に日本Zの文字を使用することは推Xしない。
　
　あえて使用する龊悉稀⑽淖芝畅`ドに注意すること。
　テクスチャ生成用の画像ファイルのパスやコントロ`ルオブジェクトのオブジェクト名など、
　ファイル名の指定に日本Zを使用する龊悉稀そのエフェクトファイルの文字コ`ドは
　必ずShift-JISでなければならない。


●ポストエフェクト
　
　ポストエフェクト用のエフェクトファイルを作成する龊悉稀
　以下のパラメ`タがエフェクトファイル中で宣言されている必要がある。
　（"●STANDARDSGLOBAL"を参照）

    float Script : STANDARDSGLOBAL <
        string ScriptOutput = "color";
        string ScriptClass = "scene";
        string ScriptOrder = "postprocess";
    > = 0.8;
　
　
　また、典型的なポストエフェクトでは、テクニックのスクリプトで以下のI理を行う。
　
　(1) レンダリングタ`ゲットを自前のテクスチャに涓し、クリアする。
      
　　　スクリプト例：
        "RenderColorTarget0=(RENDERCOLORTARGETテクスチャ);"
	    "RenderDepthStencilTarget=(RENDERDEPTHSTENCILTARGETテクスチャ);"
		"ClearSetColor=(クリアの色);"
		"ClearSetDepth=(クリアのZ);"
		"Clear=Color;"
		"Clear=Depth;"

　(2) プリエフェクト，オブジェクト，他のポストエフェクトを描画する。
　　　このとき、描画Y果は(1)で指定したテクスチャに保存される。

　　　スクリプト例：
		"ScriptExternal=Color;"
　
　(3) レンダリングタ`ゲットを元にし、描画Y果のテクスチャを入力として、パスをg行する。

　　　スクリプト例：
        "RenderColorTarget0=;"
	    "RenderDepthStencilTarget=;"
	    "Pass=(パス1);"
	    "Pass=(パス2);"